{% extends 'base.html' %}

{% block navbar %}
    {# Inclut la barre de navigation depuis un fichier s√©par√© #}
    {% include "navbar.html" %}
{% endblock %}

{% block title %}Menu du Restaurant{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto px-4 py-6">

  {# TITRE PRINCIPAL #}
  <h1 class="text-3xl font-bold text-center mb-8 text-gray-800">
    üçΩÔ∏è Menu du Restaurant
  </h1>
  {% if user.role == 'admin' %}
  <div class="flex justify-end mb-4">
    <button onclick="openModal()"
            class="bg-green-600 text-white py-2 px-4 rounded-lg hover:bg-green-700 transition">
        ‚ûï Ajouter
    </button>
</div>
    {% endif %}

  {# GRILLE DES PLATS #}
  <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
    {% for plat in plats %}
      <div class="bg-white rounded-xl shadow hover:shadow-lg transition overflow-hidden">

        {# IMAGE DU PLAT #}
        {% if plat.image %}
          <img src="{{ plat.image.url }}" alt="{{ plat.nom }}" class="w-full h-40 object-cover">
        {% else %}
          <div class="w-full h-40 bg-gray-200 flex items-center justify-center text-gray-400">
            Pas d‚Äôimage
          </div>
        {% endif %}

        {# INFORMATIONS DU PLAT (Nom et Prix) #}
        <div class="p-4 text-center">
          <h2 class="text-lg font-semibold text-gray-800">{{ plat.nom }}</h2>
          <p class="text-green-600 font-bold text-xl mt-2">{{ plat.prix_unitaire }} FG</p>

          <form method="POST" action="{% url 'ajouter_au_panier' plat.id %}">
            {% csrf_token %}
           <input type="number" name="quantite" value="1" min="1" max="10" class="w-16 text-black px-1 py-0.5 rounded">
           <button type="submit"
          class="mt-2 w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition">
           Ajouter au panier
         </button>
           </form>


          {% if user.is_authenticated %}

            {# BOUTONS AJOUTER ET MODIFIER POUR ADMIN ET CUISINIER #}
            {% if user.role == 'admin' or user.role == 'cuisinier' %}
              <button onclick="openModifyModal({{ plat.id }}, '{{ plat.nom }}', {{ plat.prix_unitaire }})"
                      class="mt-2 w-full bg-yellow-500 text-white py-2 rounded-lg hover:bg-yellow-600 transition">
                ‚úèÔ∏è Modifier
              </button>
            {% endif %}

            {# BOUTON SUPPRIMER POUR ADMIN UNIQUEMENT #}
            {% if user.role == 'admin' %}
              <button onclick="openDeleteModal({{ plat.id }}, '{{ plat.nom }}')"
                      class="mt-2 w-full bg-red-600 text-white py-2 rounded-lg hover:bg-red-700 transition">
                üóëÔ∏è Supprimer
              </button>
            {% endif %}
          {% endif %}
         

        </div>
      </div>
      
    {% empty %}
      {# Message si aucun plat n'est disponible #}
      <p class="col-span-full text-center text-gray-500">
        Aucun plat disponible pour le moment.
      </p>
    {% endfor %}
  </div>

  {# AFFICHAGE DU NOMBRE DE PLATS #}
  <p class="mt-4">Nombre de plats : {{ plats|length }}</p>
</div>

{# ===================== MODAL AJOUT ===================== #}
<div id="modalAjout" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center">
  <div class="bg-black rounded-lg p-6 w-96">
    {# Bouton pour fermer le modal #}
    <button onclick="closeModal()" class="float-right text-red-600 font-bold">&times;</button>
    <h2 class="text-xl font-bold mb-4">Ajouter un plat</h2>
    <form method="POST" enctype="multipart/form-data" action="{% url 'ajouter_plat' %}">
      {% csrf_token %}
      <div class="mb-3">
        <label class="block text-sm font-medium">Nom</label>
        <input type="text" name="nom" class="w-full border rounded-lg px-3 py-2" required>
      </div>
      <div class="mb-3">
        <label class="block text-sm font-medium">Prix</label>
        <input type="number" name="prix_unitaire" class="w-full border rounded-lg px-3 py-2" required>
      </div>
      <div class="mb-3">
        <label class="block text-sm font-medium">Image</label>
        <input type="file" name="image" class="w-full border rounded-lg px-3 py-2">
      </div>
      <button type="submit" class="w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700">
        Enregistrer
      </button>
    </form>
  </div>
</div>

{# ===================== MODAL MODIFIER ===================== #}
<div id="modalModify" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center">
  <div class="bg-black rounded-lg p-6 w-96">
    <button onclick="closeModifyModal()" class="float-right text-red-600 font-bold">&times;</button>
    <h2 class="text-xl font-bold mb-4">Modifier le plat</h2>
    <form id="modifyForm" method="POST" enctype="multipart/form-data">
      {% csrf_token %}
      <div class="mb-3">
        <label class="block text-sm font-medium">Nom</label>
        <input type="text" name="nom" id="modifyNom" class="w-full border rounded-lg px-3 py-2" required>
      </div>
      <div class="mb-3">
        <label class="block text-sm font-medium">Prix</label>
        <input type="number" name="prix_unitaire" id="modifyPrix" class="w-full border rounded-lg px-3 py-2" required>
      </div>
      <div class="mb-3">
        <label class="block text-sm font-medium">Image</label>
        <input type="file" name="image" class="w-full border rounded-lg px-3 py-2">
      </div>
      <button type="submit" class="w-full bg-yellow-500 text-white py-2 rounded-lg hover:bg-yellow-600">
        Modifier
      </button>
    </form>
  </div>
</div>

{# ===================== MODAL SUPPRIMER ===================== #}
<div id="modalDelete" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center">
  <div class="bg-black rounded-lg p-6 w-96 text-center">
    <h2 class="text-xl font-bold mb-4">Confirmer la suppression</h2>
    <p id="deletePlatName" class="mb-4"></p>
    <form id="deleteForm" method="POST">
      {% csrf_token %}
      <button type="submit" class="w-full bg-red-600 text-white py-2 rounded-lg hover:bg-red-700 transition">
        Supprimer
      </button>
      <button type="button" onclick="closeDeleteModal()"
              class="mt-2 w-full bg-gray-400 text-white py-2 rounded-lg hover:bg-gray-500 transition">
        Annuler
      </button>
    </form>
  </div>
</div>

{# ===================== SCRIPTS JS ===================== #}
<script>
  // Modal Ajouter
  function openModal() { document.getElementById('modalAjout').classList.remove('hidden'); }
  function closeModal() { document.getElementById('modalAjout').classList.add('hidden'); }

  // Modal Modifier
  function openModifyModal(platId, platName, platPrix) {
    document.getElementById('modalModify').classList.remove('hidden');
    document.getElementById('modifyNom').value = platName;
    document.getElementById('modifyPrix').value = platPrix;
    document.getElementById('modifyForm').action = "/plat/modifier/" + platId + "/";
  }
  function closeModifyModal() { document.getElementById('modalModify').classList.add('hidden'); }

  // Modal Supprimer
  function openDeleteModal(platId, platName) {
    document.getElementById('modalDelete').classList.remove('hidden');
    document.getElementById('deletePlatName').innerText = "Voulez-vous vraiment supprimer : " + platName + " ?";
    document.getElementById('deleteForm').action = "/plat/supprimer/" + platId + "/";
  }
  function closeDeleteModal() { document.getElementById('modalDelete').classList.add('hidden'); }
</script>

{% endblock %}

